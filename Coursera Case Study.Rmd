---
title: "Coursera Case Study"
author: "Justin Yee"
date: "2024-09-04"
output: html_document
---
#Introduction
##Welcome to the Cyclistic bike-share analysis case study! In this case study, you work for a fictional company, Cyclistic, along with some key team members. In order to answer the business questions, follow the steps of the data analysis process: Ask, Prepare, Process, Analyze, Share, and Act. Along the way, the Case Study Roadmap tables including guiding questions and key tasks â€” will help you stay on the right path.

```{r}
#Load Packages
library(tidyverse)
library(janitor)
library(lubridate)
library(ggplot2)
library(readr)
```

```{r}
#Importing the CSV files
jan2023 = read_csv("2023TripData/202301-divvy-tripdata.csv")
feb2023 = read_csv("2023TripData/202302-divvy-tripdata.csv")
mar2023 = read_csv("2023TripData/202303-divvy-tripdata.csv")
apr2023 = read_csv("2023TripData/202304-divvy-tripdata.csv")
may2023 = read_csv("2023TripData/202305-divvy-tripdata.csv")
jun2023 = read_csv("2023TripData/202306-divvy-tripdata.csv")
jul2023 = read_csv("2023TripData/202307-divvy-tripdata.csv")
aug2023 = read_csv("2023TripData/202308-divvy-tripdata.csv")
sep2023 = read_csv("2023TripData/202309-divvy-tripdata.csv")
oct2023 = read_csv("2023TripData/202310-divvy-tripdata.csv")
nov2023 = read_csv("2023TripData/202311-divvy-tripdata.csv")
dec2023 = read_csv("2023TripData/202312-divvy-tripdata.csv")
```

```{r}
#Getting a preview of the files structure
head(jan2023)
head(feb2023)
head(mar2023)
head(apr2023)
head(may2023)
head(jun2023)
head(jul2023)
head(aug2023)
head(sep2023)
head(oct2023)
head(nov2023)
head(dec2023)
```

```{r}
#Since they all have the same column names, I can combine them into one date frame
df_2023 = bind_rows(jan2023, feb2023, mar2023, apr2023, may2023, jun2023, jul2023, aug2023, sep2023, oct2023, nov2023, dec2023)
#clean up the name of the columns
df_2023 = clean_names(df_2023)
#To check if there are any null values in the data frame
sum(is.na(df_2023))
#Since there are null values and the data is large enough, we would remove them
df_2023 = na.omit(df_2023)
#Double check to make sure there are no more null values
sum(is.na(df_2023))
#Now all the data that is left are useful data for us
getwd()
```

```{r}
#Adding new columns for analysis usage later
#Also filtering all data where ride time is less than 30 seconds since it may be #invalid data
#Some rows failed to parse due to inconsistent format so I'll remove them
df_2023 = df_2023 %>%
  mutate(ride_time_secs = difftime(ended_at, started_at, units = "secs")) %>%
  filter(ride_time_secs > 30) %>%
  mutate(month = month(ymd_hms(started_at))) %>%
  na.omit(df_2023) %>%
  mutate(day_of_week = wday(started_at, label = TRUE, abbr = FALSE)) %>%
  mutate(hours_of_day = hour(ymd_hms(started_at))) %>%
  mutate(ride_time_minutes = as.numeric(gsub(" secs", "", ride_time_secs)) / 60)
write_csv(df_2023, "C:/Users/Justin Yee/OneDrive/Documents/RStudio/CyclistCaseStudy2023.csv")
View(df_2023)
```

```{r}
#Visualizations
#To avoid scientific notations
options(scipen = 999)
#For number of rides out of the month by member type
ride_counts <- df_2023 %>%
  group_by(month, member_casual) %>%
  summarise(number_of_rides = n(), .groups = "drop") %>%
  mutate(month = factor(month, levels = 1:12))


ggplot(data = ride_counts, aes(x = month, y = number_of_rides, fill = member_casual)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(
    title = "Number of Rides Out of the Month by Member Type",
    x = "Month of the Year",
    y = "Number of Rides",
    fill = "Member Type"
  ) + 
  theme_minimal()
```

```{r}
#For number of rides out of the week by member type
ride_counts <- df_2023 %>%
  group_by(day_of_week, member_casual) %>%
  summarise(number_of_rides = n(), .groups = "drop")

ggplot(data = ride_counts, aes(x = day_of_week, y = number_of_rides, fill = member_casual)) + 
  geom_bar(stat = "identity", position = "dodge") +
  labs(
    title = "Number of Rides Out of the Week by Member Type",
    x = "Day of the Week",
    y = "Number of Rides",
    fill = "Member Type"
  ) + 
  theme_minimal()
```
```{r}
avg_trip_duration <- df_2023 %>%
  mutate(ride_time_mins = as.numeric(ride_time_secs) / 60) %>%  # Convert seconds to minutes
  group_by(day_of_week, member_casual) %>%
  summarise(avg_ride_time = mean(ride_time_mins, na.rm = TRUE), .groups = "drop")

# Plot
ggplot(avg_trip_duration, aes(x = member_casual, y = avg_ride_time, fill = member_casual)) +
  geom_bar(stat = "identity", position = "dodge") +
  facet_wrap(~ day_of_week) +  # Facet by day of the week
  labs(
    title = "Ride Time Comparison by Member Type",
    x = "Member Type",
    y = "Average Ride Time (minutes)",
    fill = "Member Type"
  ) +
  theme_minimal() +
  theme(
    text = element_text(size = 14),
    plot.title = element_text(hjust = 0.5, size = 16),  # Center the title and increase size
    axis.text.x = element_text(size = 12),
    axis.text.y = element_text(size = 12),
    legend.position = "top"  # Move the legend to the top
  )
```

```{r}
#For number of rides out of the week by member type
ride_counts <- df_2023 %>%
  group_by(day_of_week, hours_of_day, member_casual) %>%
  summarise(number_of_rides = n(), .groups = "drop") %>%
  mutate(day_of_week = factor(day_of_week, 
                              levels = c("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday")))

# Create the plot
ggplot(data = ride_counts, aes(x = factor(hours_of_day), y = number_of_rides, fill = member_casual)) +
  geom_bar(stat = "identity", position = "stack") +
  facet_wrap(~ day_of_week, nrow = 4) +  # Creates separate plots for each day of the week
  labs(
    title = "Hourly Use of Bikes Throughout the Week",
    x = "Hours",
    y = "Number of Rides",
    fill = "Member Type"
  ) +
  theme_minimal() +
  theme(
    text = element_text(size = 12),
    plot.title = element_text(hjust = 0.5, size = 16),  # Center and enlarge title
    axis.text.x = element_text(size = 6, hjust = 1),  # Rotate x-axis labels
    legend.position = "right"  # Move the legend to the right
  )
```